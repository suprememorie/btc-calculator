<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>Jacky 的 BTC 複利計算機 v1.3</title>
  <style>
    body { font-family: sans-serif; padding: 2em; background-color: #f5f5f5; }
    input, select { margin-bottom: 1em; padding: 0.5em; width: 260px; }
    button { padding: 0.6em 1em; }
    table { border-collapse: collapse; width: 100%; margin-top: 1em; background-color: #fff; }
    th, td { border: 1px solid #ccc; padding: 0.6em; text-align: right; }
    th { background-color: #eee; }
    h3 { margin-top: 2em; }
  </style>
</head>
<body>

  <h2>Jacky BTC 複利計算機 v1.3</h2>

  <label>初始本金（NT$）：</label><br>
  <input type="number" id="initial" value="10000"><br>

  <label>每期投入金額（NT$）：</label><br>
  <input type="number" id="dca" value="5000"><br>

  <label>利率數值：</label><br>
  <input type="number" id="rate" value="0.03">
  <select id="rateType">
    <option value="year">年利率</option>
    <option value="month">月利率</option>
    <option value="week">週利率</option>
    <option value="day" selected>日利率</option>
  </select><br>

  <label>投資期間：</label><br>
  <input type="number" id="duration" value="10">
  <select id="durationType">
    <option value="year" selected>年</option>
    <option value="month">月</option>
    <option value="week">週</option>
    <option value="day">日</option>
  </select><br>

  <label>複利週期：</label><br>
  <select id="compoundType">
    <option value="year">年複利</option>
    <option value="month">月複利</option>
    <option value="week">週複利</option>
    <option value="day" selected>日複利</option>
  </select><br>

  <label>比特幣價格（USD）：</label><br>
  <input type="number" id="btcPriceUSD" value="60000"><br>

  <button onclick="calculate()">🧮 開始計算</button>

  <h3>📊 投資成長結果</h3>
  <div id="summary"></div>
  <div id="table"></div>

  <script>
    function getFactor(unit) {
      return { year: 1, month: 12, week: 52, day: 365 }[unit];
    }

    function format(n) {
      return n.toLocaleString(undefined, { maximumFractionDigits: 2 });
    }

    function calculate() {
      const initial = parseFloat(document.getElementById("initial").value) || 0;
      const dca = parseFloat(document.getElementById("dca").value) || 0;
      const rawRate = parseFloat(document.getElementById("rate").value) / 100;
      const rateType = document.getElementById("rateType").value;
      const duration = parseFloat(document.getElementById("duration").value);
      const durationType = document.getElementById("durationType").value;
      const compoundType = document.getElementById("compoundType").value;
      const btcUSD = parseFloat(document.getElementById("btcPriceUSD").value) || 60000;
      const usdToTwd = 30; // 美金換算台幣

      const ratePerCompound = Math.pow(1 + rawRate, 1 / getFactor(rateType)) - 1;
      const totalPeriods = Math.floor(duration * getFactor(durationType) / getFactor(compoundType));

      let total = initial;
      let totalInvested = initial;

      let table = `<table><thead><tr>
        <th>期數</th><th>投入金額</th><th>利息收益</th><th>總資產</th>
      </tr></thead><tbody>`;

      for (let i = 1; i <= totalPeriods; i++) {
        const interest = total * ratePerCompound;
        total += interest + dca;
        totalInvested += dca;

        if (i <= 600 || i === totalPeriods) {
          table += `<tr>
            <td>${i}</td>
            <td>${format(dca)}</td>
            <td>${format(interest)}</td>
            <td>${format(total)}</td>
          </tr>`;
        }
      }

      table += "</tbody></table>";

      const interestEarned = total - totalInvested;
      const growthRate = (interestEarned / totalInvested) * 100;
      const btcAmount = total / (btcUSD * usdToTwd);

      const summary = `
        🧾 總投入金額：${format(totalInvested)} 元<br>
        💰 利息收益：${format(interestEarned)} 元<br>
        📈 成長率：約 ${growthRate.toFixed(2)}%<br>
        ₿ 換算為 BTC：約 ${btcAmount.toFixed(6)} 顆（以 1 BTC = ${btcUSD} 美元）<br>
        ✅ 最終資產：約 ${format(total)} 元
      `;

      document.getElementById("summary").innerHTML = summary;
      document.getElementById("table").innerHTML = table;
    }
  </script>

</body>
</html>